<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Model Dashboard</title><style>
:root { --bg:#0f0a1f; --panel:#1e103b; --accent:#a855f7; --text:#f8f8ff; --muted:#cbd5e1; --border:#3a1b73; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
header{background:#4c1d95;padding:12px 16px;color:#fff;display:flex;align-items:center;justify-content:space-between}
.brand{font-weight:800;letter-spacing:.5px}.badge{border:1px solid #fff3;border-radius:999px;padding:4px 8px}
.container{max-width:1100px;margin:0 auto;padding:18px}.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:18px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}.btn{padding:10px 14px;border-radius:10px;border:1px solid #5b21b6;background:#6d28d9;color:#fff;cursor:pointer}
input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#150a2b;color:#fff}
label{display:block;margin-bottom:6px}
</style><script src="https://cdn.ably.com/lib/ably.min-1.js"></script></head>
<body><header><div class=brand>LOCAL GIRLS â€” Models <span class=badge>v8.3</span></div><a class=btn href="/login.html">Switch</a></header>
<main class=container><div class=panel>
  <h2 id=hello>Welcome</h2>
  <div style="display:flex;gap:10px;margin:10px 0"><button class=btn id=goLive>Go Live</button><button class=btn id=end style="display:none">End Stream</button></div>
  <div class=grid2>
    <div><b>Your Metrics</b><div>Total streams this month: 42 unique streams</div><div>Total Private minutes billed: 541 minutes</div><div>Total Exclusive Minutes Billed: 212 minutes</div><div>Total Tips: $987</div><div>Total Earnings: $4,789</div></div>
    <div><b>Status</b><div id=status>Offline</div><div id=dbg style="font-size:.9rem;color:#cbd5e1;margin-top:8px"></div></div>
  </div>
</div></main>
<script>
function slugify(s){ return (s||'').toLowerCase().trim().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,''); }
const profile=JSON.parse(localStorage.getItem('lg_model')||'null'); if(!profile||!profile.name) location.href='/login.html';
document.getElementById('hello').textContent='Welcome, '+profile.name;
const handle = slugify(profile.name);
let realtime=null, dir=null, hb=null, win=null;
const dbg = (m)=>{ const p=document.createElement('div'); p.textContent=m; document.getElementById('dbg').appendChild(p); };

async function initRT(){ realtime = new Ably.Realtime.Promise({ authUrl: '/api/ably-token' }); await realtime.connection.once('connected'); dir = realtime.channels.get('directory'); dbg('Ably connected'); }
function startHB(){ if(hb) return; hb=setInterval(()=>{ dir && dir.publish('join', { name: profile.name, handle }); }, 1000); dir.publish('join', { name: profile.name, handle }); }
function stopHB(){ clearInterval(hb); hb=null; dir && dir.publish('leave', { name: profile.name, handle }); }
document.getElementById('goLive').addEventListener('click', async ()=>{ try{ if(!realtime) await initRT(); startHB(); document.getElementById('status').textContent='Online'; document.getElementById('end').style.display='inline-flex'; win = window.open('/room/'+handle+'?host=1','_blank'); if(!win) alert('Allow popups for Go Live'); }catch(e){ alert('Go Live error: '+e.message); } });
document.getElementById('end').addEventListener('click', ()=>{ stopHB(); document.getElementById('status').textContent='Offline'; if(win && !win.closed) win.close(); document.getElementById('end').style.display='none'; });
</script></body></html>